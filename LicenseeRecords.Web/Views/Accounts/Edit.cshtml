@using Microsoft.AspNetCore.Mvc
@model LicenseeRecords.WebAPI.Models.Account
@{
    ViewData["Title"] = "Account Editor";

    bool AccountActive = Model.AccountStatus == LicenseeRecords.WebAPI.Enums.Status.Active;

    var ActiveLicences = Model.ProductLicence.Where(x => x.LicenceStatus == LicenseeRecords.WebAPI.Enums.Status.Active).ToList();

    var PreviousLicences = Model.ProductLicence.Where(x => x.LicenceStatus == LicenseeRecords.WebAPI.Enums.Status.Inactive).ToList();

    int Index = 0;
}
<a href="/accounts" class="govuk-back-link">Back</a>

<h1 class="govuk-heading-l">@Model.AccountName</h1>

<div class="govuk-width-container">
    <form method="post" action="/accounts/edit">
        <button type="submit" class="govuk-button" data-module="govuk-button">
            Save
        </button>

        <input name="AccountId" type="hidden" value="@Model.AccountId">
        
        <div class="govuk-form-group">
            <h1 class="govuk-label-wrapper">
                    <label class="govuk-label" for="AccountName">
                    Account name
                </label>
            </h1>
            <input class="govuk-input" name="AccountName" type="text" value="@Model.AccountName">
        </div>
        <div class="govuk-form-group">
            <label class="govuk-label" for="AccountStatus">
                Account status
            </label>
            <select class="govuk-select" name="AccountStatus">
                @if (AccountActive)
                {
                    <option value="Active" selected>Active</option>
                    <option value="Inactive">Inactive</option>
                }
                else
                {
                    <option value="Active">Active</option>
                    <option value="Inactive" selected>Inactive</option>
                }")
            </select>
        </div>

        <fieldset class="govuk-fieldset">
            <legend class="govuk-fieldset__legend govuk-fieldset__legend--l">
                <h1 class="govuk-fieldset__heading">
                    Active Licences
                </h1>
            </legend>

            @if (ActiveLicences.Count == 0)
            {
                <p class="govuk-body">No active licences</p>
            }

            @foreach (var ActiveLicence in ActiveLicences) {
                <input name="ProductLicence[@Index].LicenceId" type="hidden" value="@ActiveLicence?.LicenceId">
                <input name="ProductLicence[@Index].Product.ProductId" type="hidden" value="@ActiveLicence?.Product.ProductId">
                <div class="licence-break"></div>
                <div class="govuk-grid-row">
                    <div class="govuk-grid-column-two-thirds">
                        <div class="govuk-form-group">
                            <label class="govuk-label" for="ProductLicence[@Index].Product.ProductName">
                                Product
                            </label>
                            <select class="govuk-select" name="ProductLicence[@Index].Product.ProductName">
                                <option value="@ActiveLicence.Product.ProductName" selected>@ActiveLicence.Product.ProductName</option>
                                <option value="Other">Other</option>

                            </select>
                        </div>
                        <div class="govuk-form-group">
                            <label class="govuk-label" for="ProductLicence[@Index].LicenceFromDate">
                                Starting Date
                            </label>
                            <input class="govuk-input" name="ProductLicence[@Index].LicenceFromDate" type="datetime-local" value="@ActiveLicence?.LicenceFromDate.ToString("yyyy-MM-ddThh:mm")">
                        </div>
                    </div>

                    <div class="govuk-grid-column-one-third">
                        <div class="govuk-form-group">
                            <label class="govuk-label" for="ProductLicence[@Index].LicenceStatus">
                                Licence Status
                            </label>
                            <select class="govuk-select" name="ProductLicence[@Index].LicenceStatus">
                                @if (ActiveLicence.LicenceStatus == LicenseeRecords.WebAPI.Enums.Status.Active)
                                {
                                    <option value="Active" selected>Active</option>
                                    <option value="Inactive">Inactive</option>
                                }
                                else
                                {
                                    <option value="Active">Active</option>
                                    <option value="Inactive" selected>Inactive</option>
                                }")
                            </select>
                        </div>

                        <div class="govuk-form-group">
                            <label class="govuk-label" for="ProductLicence[@Index].LicenceToDate">
                                Closing Date
                            </label>
                            <input class="govuk-input" name="ProductLicence[@Index].LicenceToDate" type="date">
                        </div>
                    </div>
                    @{Index++;}
                </div>
            }  
        </fieldset>

        <fieldset class="govuk-fieldset">
            <legend class="govuk-fieldset__legend govuk-fieldset__legend--l">
                <h1 class="govuk-fieldset__heading">
                    Previously Active Licences
                </h1>
            </legend>

            @if(PreviousLicences.Count == 0)
            {
                <p class="govuk-body">No previously active licences</p>
            }

            @foreach (var PreviousLicence in PreviousLicences)
            {
                <input name="ProductLicence[@Index].LicenceId" type="hidden" value="@PreviousLicence?.LicenceId">
                <input name="ProductLicence[@Index].Product.ProductId" type="hidden" value="@PreviousLicence?.Product.ProductId">
                <div class="licence-break"></div>
                <div class="govuk-grid-row">
                    <div class="govuk-grid-column-two-thirds">
                        <div class="govuk-form-group">
                            <label class="govuk-label" for="ProductLicence[@Index].Product.ProductName">
                                Product
                            </label>
                            <select class="govuk-select" name="ProductLicence[@Index].Product.ProductNamed">
                                <option value="@PreviousLicence.Product.ProductName" selected>@PreviousLicence.Product.ProductName</option>
                                <option value="Other">Other</option>

                            </select>
                        </div>
                        <div class="govuk-form-group">
                            <label class="govuk-label" for="ProductLicence[@Index].LicenceFromDate">
                                Starting Date
                            </label>
                            <input class="govuk-input" name="ProductLicence[@Index].LicenceFromDate" type="datetime-local" value="@PreviousLicence?.LicenceFromDate.ToString("yyyy-MM-ddThh:mm")">
                        </div>
                    </div>

                    <div class="govuk-grid-column-one-third">
                        <div class="govuk-form-group">
                            <label class="govuk-label" for="ProductLicence[@Index].LicenceStatus">
                                Licence Status
                            </label>
                            <select class="govuk-select" name="ProductLicence[@Index].LicenceStatus">
                                @if (PreviousLicence.LicenceStatus == LicenseeRecords.WebAPI.Enums.Status.Active)
                                {
                                    <option value="Active" selected>Active</option>
                                    <option value="Inactive">Inactive</option>
                                }
                                else
                                {
                                    <option value="Active">Active</option>
                                    <option value="Inactive" selected>Inactive</option>
                                }")
                            </select>
                        </div>

                        <div class="govuk-form-group">
                            <label class="govuk-label" for="ProductLicence[@Index].LicenceToDate">
                                Date Closed
                            </label>
                            <input class="govuk-input" name="ProductLicence[@Index].LicenceToDate" type="datetime-local" value="@PreviousLicence?.LicenceToDate?.ToString("yyyy-MM-ddThh:mm")">
                        </div>
                    </div>
                    @{Index++;}
                </div>
            }
        </fieldset>
    </form>
</div>